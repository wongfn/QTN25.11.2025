
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å­¸å‹•ç‰©åˆ†é¡é€£ç·šéŠæˆ²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            overscroll-behavior: none;
            user-select: none;
            font-family: 'Comic Sans MS', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; /* ç«¥è¶£å­—é«” */
        }
        
        /* éŠæˆ²å€åŸŸå®¹å™¨ */
        #game-container {
            position: relative;
            touch-action: none; /* é˜²æ­¢è§¸æ§æ™‚çš„æ»¾å‹• */
        }

        /* SVG åœ–å±¤åœ¨æœ€ä¸Šå±¤ï¼Œä½†è¦è®“ä¸‹å±¤é»æ“Šç©¿é€åˆ°æŒ‰éˆ•ï¼Œ
           é™¤éæ˜¯åœ¨æ‹–æ›³é€£ç·šæ™‚ã€‚æˆ‘å€‘æœƒç”¨ JS æ§åˆ¶ pointer-events */
        #svg-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* é è¨­ä¸æ“‹ä½ä¸‹æ–¹ DOM */
            z-index: 10;
        }

        /* é€£ç·šæ¨£å¼ */
        .connection-line {
            stroke: #60a5fa; /* é è¨­è—è‰² */
            stroke-width: 4;
            stroke-linecap: round;
            fill: none;
            transition: stroke 0.3s;
        }
        .connection-line.correct { stroke: #22c55e; stroke-width: 5; } /* ç¶ è‰² */
        .connection-line.wrong { stroke: #ef4444; stroke-width: 5; stroke-dasharray: 10,5; } /* ç´…è‰²è™›ç·š */

        /* é¸é …å¡ç‰‡ */
        .item-card {
            transition: all 0.2s;
            cursor: pointer;
            z-index: 20; /* åœ¨ SVG ä¹‹ä¸Š */
        }
        .item-card:hover { transform: scale(1.05); }
        .item-card:active { transform: scale(0.95); }
        .item-card.selected { ring: 4px solid #3b82f6; background-color: #eff6ff; }
        
        /* é€£æ¥é» (Anchor) */
        .anchor {
            width: 16px;
            height: 16px;
            background-color: #3b82f6;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #3b82f6;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            transition: background-color 0.3s;
        }
        .item-card:hover .anchor { background-color: #2563eb; transform: translateY(-50%) scale(1.2); }

        /* å·¦å´é€£æ¥é»åœ¨å³é‚Šï¼Œå³å´é€£æ¥é»åœ¨å·¦é‚Š */
        .left-col .anchor { right: -8px; }
        .right-col .anchor { left: -8px; }

    </style>
</head>
<body class="bg-yellow-50 min-h-screen flex flex-col items-center py-6">

    <!-- æ¨™é¡Œå€ -->
    <header class="text-center mb-6 px-4">
        <h1 class="text-3xl md:text-4xl font-bold text-orange-600 mb-2">ğŸ¦ å‹•ç‰©æ‰¾æ‰¾çœ‹</h1>
        <p class="text-gray-600">è«‹å°‡å·¦é‚Šçš„å‹•ç‰©é€£ç·šåˆ°å³é‚Šæ­£ç¢ºçš„åˆ†é¡ï¼</p>
    </header>

    <!-- éŠæˆ²ä¸»é«” -->
    <main class="w-full max-w-4xl px-4 flex-grow flex flex-col items-center">
        
        <!-- ç•«å¸ƒèˆ‡å¡ç‰‡å€ -->
        <div id="game-container" class="bg-white rounded-3xl shadow-xl p-6 w-full relative flex justify-between min-h-[500px]">
            
            <!-- SVG é€£ç·šå±¤ -->
            <svg id="svg-layer">
                <!-- å·²ç¢ºèªçš„é€£ç·š -->
                <g id="lines-group"></g>
                <!-- æ‹–æ›³ä¸­çš„æš«æ™‚ç·šæ¢ -->
                <line id="drag-line" x1="0" y1="0" x2="0" y2="0" stroke="#3b82f6" stroke-width="4" stroke-dasharray="5,5" class="hidden opacity-60"></line>
            </svg>

            <!-- å·¦å´ï¼šå‹•ç‰© -->
            <div class="flex flex-col justify-around w-5/12 py-4 gap-4 left-col" id="animals-col">
                <!-- JS å‹•æ…‹ç”Ÿæˆ -->
            </div>

            <!-- å³å´ï¼šåˆ†é¡ -->
            <div class="flex flex-col justify-around w-5/12 py-4 gap-4 right-col" id="categories-col">
                <!-- JS å‹•æ…‹ç”Ÿæˆ -->
            </div>

        </div>

        <!-- æŒ‰éˆ•å€ -->
        <div class="mt-8 flex gap-4">
            <button onclick="resetGame()" class="px-6 py-3 rounded-full bg-gray-200 text-gray-700 font-bold hover:bg-gray-300 transition shadow-md">
                ğŸ”„ é‡æ–°é–‹å§‹
            </button>
            <button onclick="checkAnswers()" class="px-8 py-3 rounded-full bg-orange-500 text-white font-bold text-lg hover:bg-orange-600 transition shadow-lg transform hover:-translate-y-1">
                âœ… æª¢æŸ¥ç­”æ¡ˆ
            </button>
        </div>

        <!-- çµæœè¨Šæ¯ -->
        <div id="result-message" class="mt-4 text-2xl font-bold h-8"></div>

    </main>

    <script>
        // --- éŠæˆ²è³‡æ–™ ---
        const gameData = [
            { id: 'a1', name: 'ç‹— ğŸ¶', category: 'c1' },
            { id: 'a2', name: 'è€é·¹ ğŸ¦…', category: 'c2' },
            { id: 'a3', name: 'è›‡ ğŸ', category: 'c3' },
            { id: 'a4', name: 'é’è›™ ğŸ¸', category: 'c4' },
            { id: 'a5', name: 'é‡‘é­š ğŸ ', category: 'c5' }
        ];

        const categories = [
            { id: 'c3', name: 'çˆ¬èŸ²é¡' }, // æ•…æ„æ‰“äº‚é †åº
            { id: 'c1', name: 'å“ºä¹³é¡' },
            { id: 'c5', name: 'é­šé¡' },
            { id: 'c2', name: 'é³¥é¡' },
            { id: 'c4', name: 'å…©æ£²é¡' }
        ];

        // --- DOM å…ƒç´  ---
        const animalsCol = document.getElementById('animals-col');
        const categoriesCol = document.getElementById('categories-col');
        const svgLayer = document.getElementById('svg-layer');
        const linesGroup = document.getElementById('lines-group');
        const dragLine = document.getElementById('drag-line');
        const gameContainer = document.getElementById('game-container');
        const resultMessage = document.getElementById('result-message');

        // --- ç‹€æ…‹è®Šæ•¸ ---
        let connections = new Map(); // Key: Animal ID, Value: Category ID
        let isDragging = false;
        let startNode = null; // { id, type, x, y, el }

        // --- åˆå§‹åŒ– ---
        function initGame() {
            animalsCol.innerHTML = '';
            categoriesCol.innerHTML = '';
            linesGroup.innerHTML = '';
            connections.clear();
            resultMessage.textContent = '';
            
            // ç”Ÿæˆå·¦å´å‹•ç‰©å¡ç‰‡
            gameData.forEach(animal => {
                const card = createCard(animal.id, animal.name, 'animal', animal.category);
                animalsCol.appendChild(card);
            });

            // ç”Ÿæˆå³å´åˆ†é¡å¡ç‰‡
            categories.forEach(cat => {
                const card = createCard(cat.id, cat.name, 'category', null);
                categoriesCol.appendChild(card);
            });
        }

        function createCard(id, text, type, matchId) {
            const div = document.createElement('div');
            div.className = `item-card bg-white border-2 border-gray-200 rounded-xl p-4 flex items-center shadow-sm relative ${type === 'animal' ? 'justify-end pr-8' : 'justify-start pl-8'}`;
            div.dataset.id = id;
            div.dataset.type = type;
            if (matchId) div.dataset.matchId = matchId;

            // æ–‡å­—æ¨™ç±¤
            const span = document.createElement('span');
            span.className = "text-xl font-bold text-gray-700 pointer-events-none"; // é˜²æ­¢æ–‡å­—å¹²æ“¾é»æ“Š
            span.textContent = text;
            div.appendChild(span);

            // é€£æ¥é» (Anchor)
            const anchor = document.createElement('div');
            anchor.className = "anchor";
            div.appendChild(anchor);

            // äº‹ä»¶ç›£è½
            div.addEventListener('mousedown', handleStart);
            div.addEventListener('touchstart', handleStart, {passive: false});

            return div;
        }

        // --- äº’å‹•é‚è¼¯ ---

        function getRelativePos(element) {
            const rect = element.getBoundingClientRect();
            const containerRect = gameContainer.getBoundingClientRect();
            const anchor = element.querySelector('.anchor');
            const anchorRect = anchor.getBoundingClientRect();

            return {
                x: anchorRect.left + anchorRect.width / 2 - containerRect.left,
                y: anchorRect.top + anchorRect.height / 2 - containerRect.top
            };
        }

        function handleStart(e) {
            e.preventDefault(); // é˜²æ­¢é¸å–æ–‡å­—
            if (connections.size >= 5 && !connections.has(this.dataset.id)) return; // ç°¡å–®é™åˆ¶

            const type = this.dataset.type;
            // åªå…è¨±å¾å‹•ç‰©é€£åˆ°åˆ†é¡ï¼Œæˆ–è€…é›™å‘çš†å¯ã€‚é€™è£¡è¨­å®šï¼šå¿…é ˆå¾å·¦é€£åˆ°å³ï¼Œæˆ–å¾å³é€£åˆ°å·¦çš†å¯ã€‚
            // ç‚ºäº†ç°¡åŒ–ï¼Œæˆ‘å€‘è¨˜éŒ„ "startNode"
            
            const pos = getRelativePos(this);
            startNode = {
                id: this.dataset.id,
                type: type,
                x: pos.x,
                y: pos.y,
                el: this
            };

            // å¦‚æœå·²ç¶“æœ‰é€£ç·šï¼Œå…ˆåˆªé™¤èˆŠçš„
            if (type === 'animal' && connections.has(startNode.id)) {
                deleteConnection(startNode.id);
            } else if (type === 'category') {
                // å¦‚æœæ˜¯å¾åˆ†é¡é–‹å§‹æ‹‰ï¼Œå…ˆæª¢æŸ¥æ˜¯å¦æœ‰å‹•ç‰©é€£åˆ°é€™ï¼Œå¦‚æœæœ‰å‰‡æ–·é–‹ï¼ˆUIé‚è¼¯è¼ƒè¤‡é›œï¼Œé€™è£¡æš«ç°¡åŒ–ï¼šåªæ”¯æ´å¾ç„¡åˆ°æœ‰ï¼‰
                // ç‚ºäº†é«”é©—å¥½ï¼Œæˆ‘å€‘å…è¨±å¾åˆ†é¡æ‹‰å›å‹•ç‰©
            }

            isDragging = true;
            
            // è¨­å®šæ‹–æ›³ç·šèµ·é»
            dragLine.setAttribute('x1', pos.x);
            dragLine.setAttribute('y1', pos.y);
            dragLine.setAttribute('x2', pos.x);
            dragLine.setAttribute('y2', pos.y);
            dragLine.classList.remove('hidden');

            this.classList.add('selected');
        }

        function handleMove(e) {
            if (!isDragging || !startNode) return;
            e.preventDefault();

            // è¨ˆç®—æ»‘é¼ åœ¨ container å…§çš„åº§æ¨™
            const containerRect = gameContainer.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            const x = clientX - containerRect.left;
            const y = clientY - containerRect.top;

            dragLine.setAttribute('x2', x);
            dragLine.setAttribute('y2', y);
        }

        function handleEnd(e) {
            if (!isDragging) return;
            
            // åˆ¤æ–·æ˜¯å¦é‡‹æ”¾åœ¨æœ‰æ•ˆç›®æ¨™ä¸Š
            // å› ç‚º pointer-events: none åœ¨ SVG ä¸Šï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ document.elementFromPoint
            const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
            const clientY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
            
            // æš«æ™‚éš±è— dragLine ä»¥ä¾¿åµæ¸¬ä¸‹æ–¹çš„å…ƒç´ 
            dragLine.classList.add('hidden');
            const targetEl = document.elementFromPoint(clientX, clientY)?.closest('.item-card');
            dragLine.classList.remove('hidden');

            let validConnection = false;

            if (targetEl && targetEl !== startNode.el) {
                const targetType = targetEl.dataset.type;
                const targetId = targetEl.dataset.id;

                // è¦å‰‡ï¼šå¿…é ˆé€£ç·šåˆ°ã€Œä¸åŒé¡å‹ã€çš„å¡ç‰‡ (å‹•ç‰© <-> åˆ†é¡)
                if (startNode.type !== targetType) {
                    // ç¢ºå®š Animal ID å’Œ Category ID
                    const animalId = startNode.type === 'animal' ? startNode.id : targetId;
                    const categoryId = startNode.type === 'category' ? startNode.id : targetId;

                    // å»ºç«‹é€£ç·š
                    createConnection(animalId, categoryId);
                    validConnection = true;
                }
            }

            // é‡ç½®ç‹€æ…‹
            isDragging = false;
            dragLine.classList.add('hidden');
            startNode.el.classList.remove('selected');
            startNode = null;
        }

        function createConnection(animalId, categoryId) {
            // å¦‚æœè©²å‹•ç‰©å·²ç¶“æœ‰é€£ç·šï¼Œç§»é™¤èˆŠè¦–è¦º
            deleteConnection(animalId);
            
            // å„²å­˜æ–°é€£ç·š
            connections.set(animalId, categoryId);
            
            // ç¹ªè£½ç·šæ¢
            drawStoredLines();
        }

        function deleteConnection(animalId) {
            if (connections.has(animalId)) {
                connections.delete(animalId);
                drawStoredLines();
            }
        }

        function drawStoredLines() {
            linesGroup.innerHTML = '';
            
            connections.forEach((catId, animalId) => {
                const animalEl = document.querySelector(`.item-card[data-id="${animalId}"]`);
                const catEl = document.querySelector(`.item-card[data-id="${catId}"]`);
                
                if (animalEl && catEl) {
                    const pos1 = getRelativePos(animalEl);
                    const pos2 = getRelativePos(catEl);

                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', pos1.x);
                    line.setAttribute('y1', pos1.y);
                    line.setAttribute('x2', pos2.x);
                    line.setAttribute('y2', pos2.y);
                    line.setAttribute('class', 'connection-line');
                    line.setAttribute('data-animal', animalId); // æ¨™è¨˜ç”¨
                    linesGroup.appendChild(line);
                }
            });
        }

        // --- æª¢æŸ¥é‚è¼¯ ---

        function checkAnswers() {
            if (connections.size === 0) {
                resultMessage.textContent = "é‚„æ²’æœ‰é€£ç·šå–”ï¼åŠ æ²¹è©¦è©¦çœ‹ ğŸ§";
                resultMessage.className = "mt-4 text-2xl font-bold text-gray-500";
                return;
            }

            let correctCount = 0;
            const lines = linesGroup.querySelectorAll('line');

            // éæ­·æ‰€æœ‰è¦–è¦ºä¸Šçš„ç·šæ¢é€²è¡Œæª¢æŸ¥
            lines.forEach(line => {
                const animalId = line.getAttribute('data-animal');
                const catId = connections.get(animalId);
                
                const animalEl = document.querySelector(`.item-card[data-id="${animalId}"]`);
                const correctCatId = animalEl.dataset.matchId;

                if (catId === correctCatId) {
                    line.classList.add('correct');
                    line.classList.remove('wrong');
                    correctCount++;
                } else {
                    line.classList.add('wrong');
                    line.classList.remove('correct');
                }
            });

            // é¡¯ç¤ºçµæœ
            if (correctCount === 5) {
                resultMessage.textContent = "å¤ªæ£’äº†ï¼å…¨éƒ¨ç­”å°ï¼ ğŸ‰ğŸ’¯";
                resultMessage.className = "mt-4 text-2xl font-bold text-green-600 animate-bounce";
            } else {
                resultMessage.textContent = `ç­”å°äº† ${correctCount} é¡Œï¼Œå†è©¦è©¦çœ‹å§ï¼ ğŸ’ª`;
                resultMessage.className = "mt-4 text-2xl font-bold text-orange-600";
            }
        }

        function resetGame() {
            connections.clear();
            drawStoredLines();
            resultMessage.textContent = "";
            
            // ç§»é™¤æ‰€æœ‰æ­£ç¢º/éŒ¯èª¤æ¨£å¼
            const cards = document.querySelectorAll('.item-card');
            cards.forEach(c => c.classList.remove('selected'));
        }

        // --- å…¨åŸŸäº‹ä»¶ç›£è½ (ç”¨æ–¼æ‹–æ›³) ---
        window.addEventListener('mousemove', handleMove);
        window.addEventListener('mouseup', handleEnd);
        window.addEventListener('touchmove', handleMove, {passive: false});
        window.addEventListener('touchend', handleEnd);

        // å•Ÿå‹•
        initGame();

        // è¦–çª—æ”¹è®Šå¤§å°æ™‚é‡ç¹ªç·šæ¢ä½ç½®
        window.addEventListener('resize', () => {
            drawStoredLines();
        });

    </script>
</body>
</html>
