<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•å¼ä¸‰è§’å½¢è§’åº¦è¨ˆç®—</title>
    <!-- ä½¿ç”¨ Tailwind CSS é€²è¡Œå¿«é€Ÿä½ˆå±€ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            overscroll-behavior: none; /* é˜²æ­¢æ‰‹æ©Ÿä¸‹æ‹‰é‡æ•´ */
            user-select: none; /* é˜²æ­¢æ‹–æ›³æ™‚é¸å–æ–‡å­— */
        }
        
        #canvas-container {
            background-image: 
                linear-gradient(rgba(200, 200, 200, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(200, 200, 200, 0.3) 1px, transparent 1px);
            background-size: 20px 20px;
            cursor: crosshair;
        }

        /* SVG å…ƒç´ æ¨£å¼ */
        .triangle-shape {
            fill: rgba(59, 130, 246, 0.2); /* è—è‰²åŠé€æ˜å¡«å…… */
            stroke: #2563eb; /* è—è‰²é‚Šæ¡† */
            stroke-width: 3;
            stroke-linejoin: round;
        }

        .vertex-handle {
            fill: #ffffff;
            stroke: #dc2626; /* ç´…è‰²é‚Šæ¡† */
            stroke-width: 3;
            cursor: move; /* æ»‘é¼ ç§»ä¸Šå»è®Šæ›´æ¸¸æ¨™ */
            transition: r 0.1s ease;
        }

        .vertex-handle:hover, .vertex-handle.active {
            fill: #fee2e2;
            r: 10; /* æ‡¸åœæ™‚è®Šå¤§ */
            stroke: #b91c1c;
        }

        .angle-text {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            font-size: 14px;
            font-weight: bold;
            fill: #1f2937;
            pointer-events: none; /* è®“æ–‡å­—ä¸å¹²æ“¾æ»‘é¼ é»æ“Š */
            text-anchor: middle;
            dominant-baseline: middle;
        }

        .instruction-box {
            backdrop-filter: blur(4px);
            background-color: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col items-center justify-center overflow-hidden">

    <!-- æ¨™é¡Œèˆ‡èªªæ˜ -->
    <div class="absolute top-4 left-1/2 transform -translate-x-1/2 text-center z-10 w-full px-4">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2 drop-shadow-sm">ä¸‰è§’å½¢è§’åº¦å‹•æ…‹æ¼”ç¤º</h1>
        <div class="instruction-box inline-block px-4 py-2 rounded-full border border-gray-200 shadow-sm">
            <p class="text-sm text-gray-600">ğŸ‘† æ‹–æ›³ç´…é»ä¾†æ”¹è®Šå½¢ç‹€ï¼Œç³»çµ±å°‡å³æ™‚è¨ˆç®—è§’åº¦</p>
        </div>
    </div>

    <!-- ä¸»ç¹ªåœ–å€ -->
    <div class="relative w-full h-full flex items-center justify-center p-4">
        <div class="w-full max-w-4xl aspect-video bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden relative" id="canvas-wrapper">
            <svg id="svg-canvas" class="w-full h-full" id="canvas-container">
                <!-- å®šç¾©ä¸‰è§’å½¢ -->
                <polygon id="triangle" class="triangle-shape" points=""></polygon>
                
                <!-- è§’åº¦æ–‡å­— (é å…ˆå»ºç«‹) -->
                <text id="text-0" class="angle-text"></text>
                <text id="text-1" class="angle-text"></text>
                <text id="text-2" class="angle-text"></text>

                <!-- æ§åˆ¶é» (æœ€å¾Œç¹ªè£½ä»¥ç¢ºä¿åœ¨æœ€ä¸Šå±¤) -->
                <circle id="p-0" class="vertex-handle" r="8"></circle>
                <circle id="p-1" class="vertex-handle" r="8"></circle>
                <circle id="p-2" class="vertex-handle" r="8"></circle>
            </svg>
        </div>
    </div>

    <!-- åº•éƒ¨è³‡è¨Š -->
    <div class="absolute bottom-4 text-gray-400 text-xs">
        å…§è§’å’Œç¸½è¨ˆ: <span id="total-angle">180</span>Â°
    </div>

    <script>
        // åˆå§‹åŒ– SVG èˆ‡ç‹€æ…‹
        const svg = document.getElementById('svg-canvas');
        const triangleEl = document.getElementById('triangle');
        const totalAngleEl = document.getElementById('total-angle');
        
        // å®šç¾©ä¸‰å€‹é ‚é»çš„åˆå§‹ç‹€æ…‹ (ç›¸å°åº§æ¨™ï¼Œå°‡åœ¨ init ä¸­è½‰æ›ç‚ºå¯¦éš›ç•«å¸ƒåº§æ¨™)
        let points = [
            { x: 300, y: 150, el: document.getElementById('p-0'), textEl: document.getElementById('text-0') }, // é ‚é» A
            { x: 150, y: 400, el: document.getElementById('p-1'), textEl: document.getElementById('text-1') }, // é ‚é» B
            { x: 450, y: 400, el: document.getElementById('p-2'), textEl: document.getElementById('text-2') }  // é ‚é» C
        ];

        let activePointIndex = -1; // ç•¶å‰è¢«æ‹–æ›³çš„é»ç´¢å¼•

        // åˆå§‹åŒ–ç•«å¸ƒå°ºå¯¸ç›¸é—œé‚è¼¯
        function init() {
            // éŸ¿æ‡‰å¼èª¿æ•´åˆå§‹ä½ç½®ï¼ˆå¦‚æœè¢å¹•è¼ƒå°ï¼‰
            const rect = svg.getBoundingClientRect();
            const cx = rect.width / 2;
            const cy = rect.height / 2;
            
            // åœç¹ä¸­å¿ƒè¨­å®šåˆå§‹ä¸‰è§’å½¢
            points[0].x = cx;       points[0].y = cy - 100;
            points[1].x = cx - 100; points[1].y = cy + 80;
            points[2].x = cx + 100; points[2].y = cy + 80;

            updateCanvas();
        }

        // --- æ ¸å¿ƒé‚è¼¯ï¼šè¨ˆç®—èˆ‡ç¹ªè£½ ---

        function updateCanvas() {
            // 1. æ›´æ–°ä¸‰è§’å½¢è·¯å¾‘
            const pointsStr = points.map(p => `${p.x},${p.y}`).join(' ');
            triangleEl.setAttribute('points', pointsStr);

            // 2. è¨ˆç®—é‚Šé•· (Distance formula)
            // side 0 å°æ‡‰ points[0] çš„å°é‚Š (BC), side 1 å°æ‡‰ AC, side 2 å°æ‡‰ AB
            // ç‚ºäº†æ–¹ä¾¿è¨ˆç®—è§’åº¦ A (points[0])ï¼Œæˆ‘å€‘éœ€è¦é‚Š b(AC) å’Œ c(AB) å’Œå°é‚Š a(BC)
            const dist = (p1, p2) => Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));
            
            const a = dist(points[1], points[2]); // é‚Š BC
            const b = dist(points[0], points[2]); // é‚Š AC
            const c = dist(points[0], points[1]); // é‚Š AB

            // 3. è¨ˆç®—è§’åº¦ (Law of Cosines: c^2 = a^2 + b^2 - 2ab cos(C))
            // è§’åº¦ A = acos((b^2 + c^2 - a^2) / (2bc))
            const calcAngle = (side1, side2, oppositeSide) => {
                const val = (Math.pow(side1, 2) + Math.pow(side2, 2) - Math.pow(oppositeSide, 2)) / (2 * side1 * side2);
                // è™•ç†æµ®é»æ•¸èª¤å·®å°è‡´æ•¸å€¼è¶…å‡º [-1, 1] çš„æƒ…æ³
                const clampedVal = Math.max(-1, Math.min(1, val)); 
                return Math.acos(clampedVal) * (180 / Math.PI);
            };

            const ang0 = calcAngle(b, c, a); // Angle A
            const ang1 = calcAngle(a, c, b); // Angle B
            const ang2 = calcAngle(a, b, c); // Angle C

            const angles = [ang0, ang1, ang2];

            // è¨ˆç®—é‡å¿ƒ (Centroid) ç”¨æ–¼æ–‡å­—æ¨™ç±¤æ’ç‰ˆ
            const centroid = {
                x: (points[0].x + points[1].x + points[2].x) / 3,
                y: (points[0].y + points[1].y + points[2].y) / 3
            };

            // 4. æ›´æ–°æ§åˆ¶é»ä½ç½®èˆ‡æ–‡å­—æ¨™ç±¤
            points.forEach((p, index) => {
                // æ›´æ–°åœ“é»ä½ç½®
                p.el.setAttribute('cx', p.x);
                p.el.setAttribute('cy', p.y);

                // æ›´æ–°æ–‡å­—å…§å®¹
                p.textEl.textContent = angles[index].toFixed(1) + 'Â°';

                // æ›´æ–°æ–‡å­—ä½ç½®ï¼š
                // ç‚ºäº†ä¸è“‹ä½ç·šæ¢ï¼Œæ–‡å­—æ‡‰è©²å¾€ "é‡å¿ƒ -> é ‚é»" çš„å‘é‡æ–¹å‘å‘å¤–æ¨
                const vecX = p.x - centroid.x;
                const vecY = p.y - centroid.y;
                const len = Math.sqrt(vecX*vecX + vecY*vecY);
                
                // å–®ä½å‘é‡ * åç§»é‡ (35px)
                const offset = 35;
                const textX = p.x + (vecX / len) * offset;
                const textY = p.y + (vecY / len) * offset;

                p.textEl.setAttribute('x', textX);
                p.textEl.setAttribute('y', textY);
            });

            // ç°¡å–®æª¢æŸ¥ç¸½å’Œ (æ‡‰è©²ç¸½æ˜¯ 180ï¼Œé™¤äº†æ¥µç«¯èª¤å·®)
            totalAngleEl.textContent = Math.round(ang0 + ang1 + ang2);
        }

        // --- äº’å‹•äº‹ä»¶è™•ç† (Mouse & Touch) ---

        // å°‡è¢å¹•åº§æ¨™è½‰æ›ç‚º SVG å…§éƒ¨åº§æ¨™ (è™•ç†ç¸®æ”¾èˆ‡è¦–çª—å¤§å°)
        function getSVGCoordinates(evt) {
            const CTM = svg.getScreenCTM();
            let pt = svg.createSVGPoint();
            // è™•ç†è§¸æ§æˆ–æ»‘é¼ äº‹ä»¶
            const clientX = evt.touches ? evt.touches[0].clientX : evt.clientX;
            const clientY = evt.touches ? evt.touches[0].clientY : evt.clientY;
            
            pt.x = clientX;
            pt.y = clientY;
            return pt.matrixTransform(CTM.inverse());
        }

        // é–‹å§‹æ‹–æ›³
        function startDrag(index, evt) {
            evt.preventDefault(); // é˜²æ­¢æ‰‹æ©Ÿä¸Šçš„æ»¾å‹•
            activePointIndex = index;
            points[index].el.classList.add('active');
        }

        // ç¶å®šäº‹ä»¶åˆ°æ¯å€‹æ§åˆ¶é»
        points.forEach((p, index) => {
            // Mouse
            p.el.addEventListener('mousedown', (e) => startDrag(index, e));
            // Touch
            p.el.addEventListener('touchstart', (e) => startDrag(index, e), {passive: false});
        });

        // ç§»å‹•ä¸­ (ç¶å®šåˆ° SVG æˆ– Window ä»¥é˜²æ­¢å¿«é€Ÿç§»å‹•æ™‚è„«é‰¤)
        function handleMove(evt) {
            if (activePointIndex === -1) return;
            
            evt.preventDefault();
            const loc = getSVGCoordinates(evt);
            
            // é™åˆ¶é‚Šç•Œ (å¯é¸ï¼Œé˜²æ­¢æ‹–å‡ºç•«å¸ƒ)
            const padding = 10;
            const rect = svg.getBoundingClientRect(); // é€™è£¡å–çš„æ˜¯å®¹å™¨å¤§å°ï¼Œä¸æ˜¯SVGåº§æ¨™ç³»ï¼Œç°¡å–®èµ·è¦‹ç›´æ¥ç”¨è½‰æ›å¾Œçš„ loc
            
            // æ›´æ–°æ•¸æ“š
            points[activePointIndex].x = loc.x;
            points[activePointIndex].y = loc.y;
            
            requestAnimationFrame(updateCanvas);
        }

        // çµæŸæ‹–æ›³
        function endDrag() {
            if (activePointIndex !== -1) {
                points[activePointIndex].el.classList.remove('active');
                activePointIndex = -1;
            }
        }

        // å…¨åŸŸç›£è½ç§»å‹•èˆ‡é‡‹æ”¾
        window.addEventListener('mousemove', handleMove);
        window.addEventListener('mouseup', endDrag);
        
        // è§¸æ§å…¨åŸŸç›£è½
        svg.addEventListener('touchmove', handleMove, {passive: false});
        window.addEventListener('touchend', endDrag);

        // è¦–çª—èª¿æ•´æ™‚é‡æ–°è¨ˆç®—ä½ˆå±€ (å¯é¸)
        window.addEventListener('resize', () => {
             // é€™è£¡ä¸åšé‡ç½®ï¼Œä¿ç•™ä½¿ç”¨è€…æ‹–æ›³å¾Œçš„å½¢ç‹€ï¼Œä½†ç¢ºä¿èƒ½é©æ‡‰
        });

        // å•Ÿå‹•
        // ä½¿ç”¨ setTimeout ç¢ºä¿ DOM æ¸²æŸ“å®Œç•¢å¾Œç²å–æ­£ç¢ºå°ºå¯¸
        setTimeout(init, 50);

    </script>
</body>
</html>
